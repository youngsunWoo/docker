<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter3# 고급와이어링 | Sunny Archive</title>
    <meta name="description" content="개발 관련 블로그">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="icon" href="/sunny-archive/favicon.ico">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons">
    
    <link rel="preload" href="/sunny-archive/assets/css/0.styles.a7ac78a8.css" as="style"><link rel="preload" href="/sunny-archive/assets/js/app.20f77d52.js" as="script"><link rel="preload" href="/sunny-archive/assets/js/2.511b4fc5.js" as="script"><link rel="preload" href="/sunny-archive/assets/js/21.77345df6.js" as="script"><link rel="prefetch" href="/sunny-archive/assets/js/10.a0ef1271.js"><link rel="prefetch" href="/sunny-archive/assets/js/11.6541ddd8.js"><link rel="prefetch" href="/sunny-archive/assets/js/12.1903e15c.js"><link rel="prefetch" href="/sunny-archive/assets/js/13.197863a7.js"><link rel="prefetch" href="/sunny-archive/assets/js/14.9b068972.js"><link rel="prefetch" href="/sunny-archive/assets/js/15.54027cd4.js"><link rel="prefetch" href="/sunny-archive/assets/js/16.524f5d92.js"><link rel="prefetch" href="/sunny-archive/assets/js/17.11708487.js"><link rel="prefetch" href="/sunny-archive/assets/js/18.5d867f86.js"><link rel="prefetch" href="/sunny-archive/assets/js/19.0f648627.js"><link rel="prefetch" href="/sunny-archive/assets/js/20.27ef1d38.js"><link rel="prefetch" href="/sunny-archive/assets/js/22.085befa6.js"><link rel="prefetch" href="/sunny-archive/assets/js/23.8490966f.js"><link rel="prefetch" href="/sunny-archive/assets/js/24.ec8405cd.js"><link rel="prefetch" href="/sunny-archive/assets/js/25.b0db359b.js"><link rel="prefetch" href="/sunny-archive/assets/js/26.46aa84cd.js"><link rel="prefetch" href="/sunny-archive/assets/js/27.8c499cc1.js"><link rel="prefetch" href="/sunny-archive/assets/js/28.a0f23262.js"><link rel="prefetch" href="/sunny-archive/assets/js/3.6c4817b1.js"><link rel="prefetch" href="/sunny-archive/assets/js/4.360058bb.js"><link rel="prefetch" href="/sunny-archive/assets/js/5.c75d34e9.js"><link rel="prefetch" href="/sunny-archive/assets/js/6.7ef6ecd2.js"><link rel="prefetch" href="/sunny-archive/assets/js/7.e7a5c462.js"><link rel="prefetch" href="/sunny-archive/assets/js/8.07adb725.js"><link rel="prefetch" href="/sunny-archive/assets/js/9.026c5ddc.js">
    <link rel="stylesheet" href="/sunny-archive/assets/css/0.styles.a7ac78a8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/sunny-archive/" class="home-link router-link-active"><!----> <span class="site-name">Sunny Archive</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/youngsunWoo/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/youngsunWoo/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/sunny-archive/" class="sidebar-heading clickable router-link-active open"><span>책읽기</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>JAVA</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>스프링 인 액션</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/sunny-archive/springFramework/springInAction/Chapter01.html" class="sidebar-link">Chapter01# Spring속으로</a></li><li><a href="/sunny-archive/springFramework/springInAction/Chapter02.html" class="sidebar-link">Chapter02# Spring BeanWiring</a></li><li><a href="/sunny-archive/springFramework/springInAction/Chapter03.html" class="active sidebar-link">Chapter03# 고급와이어링</a></li><li><a href="/sunny-archive/springFramework/springInAction/Chapter04.html" class="sidebar-link">Chapter04# AOP</a></li><li><a href="/sunny-archive/springFramework/springInAction/Chapter05.html" class="sidebar-link">Chapter05# Spring Web Application</a></li><li><a href="/sunny-archive/springFramework/springInAction/Chapter19.html" class="sidebar-link">Chapter19# 이메일전송하기</a></li><li><a href="/sunny-archive/springFramework/springInAction/Chapter20.html" class="sidebar-link">Chapter20# JXM을 이용한 스프링 빈 관리</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="chapter3-고급와이어링"><a href="#chapter3-고급와이어링" class="header-anchor">#</a> Chapter3# 고급와이어링</h1> <h3 id="_1-스프링-프로파일"><a href="#_1-스프링-프로파일" class="header-anchor">#</a> 1.스프링 프로파일</h3> <p>데이터베이스 설정, 암호화 알고리즘 및 외부 시스템과의 통합은 전체 환경에 걸쳐 변동될 가능 성이 있다.<br>
이러한 문제점을 스프링은 재구성을 하지 않고 해결할 수 있다.</p> <p><strong>1.1 빈 프로파일 설정</strong>
spring 3.1에서 도입된 개념으로 @Profile 어노테이션을 이용<br>
@Profile 애너테이션은 설정 클래스의 빈이 dev 프로파일이 활성화된 경우에만 작성되어야 함을 스프링에 알려 준다.<br>
dev 프로파일이 활성화되지 않은 경우, @Bean 메소드는 무시된다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;dev&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSourceConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>destroyMethod<span class="token operator">=</span><span class="token string">&quot;shutdown&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">embeddedDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">EmbeddedDatabaseBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">EmbeddedDatabaseType</span><span class="token punctuation">.</span>H2<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addScript</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:schema.sql&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">addScript</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:test-data.sql&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>스프링 3.2 이상에서는 @Bean 애너테이션과 함께 메소드 수준에서 @Profile을 사용<br>
하나의 설정 클래스에서 두개의 빈 선언이 가능하다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSourceConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;dev&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">embededDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">EmbeddedDatabaseBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">EmbeddedDatabaseType</span><span class="token punctuation">.</span>H2<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">addScript</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:schema.sql&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">addScript</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:test-data.sql&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Profile</span><span class="token punctuation">(</span><span class="token string">&quot;prod&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">jndiDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">JndiObjectFactoryBean</span> jndiObjectFactoryBean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JndiObjectFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jndiObjectFactoryBean<span class="token punctuation">.</span><span class="token function">setJndiName</span><span class="token punctuation">(</span><span class="token string">&quot;jdbc/myDS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jndiObjectFactoryBean<span class="token punctuation">.</span><span class="token function">setResourceRef</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jndiObjectFactoryBean<span class="token punctuation">.</span><span class="token function">setProxyInterface</span><span class="token punctuation">(</span>javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span><span class="token class-name">DataSource</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">DataSource</span><span class="token punctuation">)</span>jndiObjectFactoryBean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>프로파일 활성화 여부와 상관없이, 프로파일이 지정되지 않은 모든 빈은 항상 활성화 된다.</p> <p><strong>1.2 빈 프로파일 활성화하기</strong>
스프링은 프로파일이 활성 상태인지를 결정하는 두 가지 프로퍼티를 가진다.<br>
spring.profiles.active<br>
spring.profiles.default</p> <p>spring.profiles.active가 설정되어 있는 경우, 그 값은 프로파일이 활성 상태인지를 결정한다.<br>
spring.profiles.active가 설정되어 있지 않으면 스프링은 spring.profiles.default가 된다.<br>
spring.profiles.active 또는 spring.profiles.default가 설정되어 있지 않은 경우, 활성화 프로파일은 없으며 프로파일에 정의되지 않은 빈만 만들어진다.</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://java.sun.com/xml/ns/javaee<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://java.sun.com/xml/ns/javaee
        http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>WebApp_ID<span class="token punctuation">&quot;</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2.5<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>display-name</span><span class="token punctuation">&gt;</span></span>study<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>display-name</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context-param</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>contextConfigLocation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>classpath:spring/application-config.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context-param</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!—</span> <span class="token attr-name">컨텍스트를</span> <span class="token attr-name">위한</span> <span class="token attr-name">기본</span> <span class="token attr-name">프로파일</span> <span class="token attr-name">설정</span>  <span class="token attr-name">—</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>context-param</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>spring.profiles.default<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>dev<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>context-param</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>listener-class</span><span class="token punctuation">&gt;</span></span>
            org.springframework.web.context.ContextLoaderListener
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener-class</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>listener</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>dispatcherServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>org.springframework.web.servlet.DispatcherServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>contextConfigLocation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>/WEB-INF/mvc-config.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!—</span> <span class="token attr-name">서블릿을</span> <span class="token attr-name">위한</span> <span class="token attr-name">기본</span> <span class="token attr-name">프로파일</span> <span class="token attr-name">설정</span> <span class="token attr-name">—</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>spring.profiles.default<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>dev<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>load-on-startup</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>load-on-startup</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>dispatcherServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_2-조건부-빈"><a href="#_2-조건부-빈" class="header-anchor">#</a> 2. 조건부 빈</h3> <p>스프링 4.0 에서는 @Bean 을 적용할 수 있는 새로운 @Conditional 애너테이션 존재<br>
조건이 참인 경우 빈이 생성, 그렇지 않으면 빈은 무시</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Conditional</span><span class="token punctuation">(</span><span class="token class-name">MagicExistsCondition</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">MagicBean</span> <span class="token function">magicBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MagicBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Conditional</span>은 <span class="token class-name">Condition</span> 인터페이스와 같이 사용된다<span class="token punctuation">.</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Condition</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">ConditionContext</span> ctxt<span class="token punctuation">,</span>
                    <span class="token class-name">AnnotationTypeMetadata</span> metadata<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_3-autowired-의-애매성"><a href="#_3-autowired-의-애매성" class="header-anchor">#</a> 3. Autowired 의 애매성</h3> <p>동일한 인터페이의 구현체가 여러개 있는 경우 Autowired하면 오류발생</p> <blockquote><p>NouniqueBeanDefinitionException</p></blockquote> <p>Sample Code</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDessert</span><span class="token punctuation">(</span><span class="token class-name">Dessert</span> dessert<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dessert <span class="token operator">=</span> dessert
<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cake</span> <span class="token keyword">implements</span> <span class="token class-name">Dessert</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cookies</span> <span class="token keyword">implements</span> <span class="token class-name">Dessert</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IceCream</span> <span class="token keyword">implements</span> <span class="token class-name">Dessert</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
</code></pre></div><p><strong>3.1 @Primary</strong>
@Primary제한자를 통해 “선호하는” 빈을 선언 가능하며 해당 빈을 우선으로 찾는다</p> <blockquote><blockquote><p>그런데 아래 sample처럼 @Primary 가 여러번 선언된다면..? 결국 같은 문제가 발생하게 된다.</p></blockquote></blockquote> <p>Sample Code</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Primary</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cake</span> <span class="token keyword">implements</span> <span class="token class-name">Dessert</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@Primary</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cookies</span> <span class="token keyword">implements</span> <span class="token class-name">Dessert</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
</code></pre></div><p><strong>3.2 @Qualifier</strong>
Sample Code</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span>“iceCream”<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDessert</span><span class="token punctuation">(</span><span class="token class-name">Dessert</span> dessert<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dessert <span class="token operator">=</span> dessert
<span class="token punctuation">}</span>
</code></pre></div><p>Qualifier의 파라미터는 는 주입할 빈의 id값이다.<br>
기본적으로 @Compomnent 어노테이션으로 생성된 빈은 소문자로 시작하는 클래스명으로 생성된다. (문자열 iceCream을 기본수식자로 가지는 빈을 참조한다)</p> <blockquote><blockquote><p>클래스 이름이 변경되거나 리팩토링 하는 경우 빈의 id와 기본 수식자가 변경되고 결국 빈을 찾을수 없는 문제가 발생한다<br>
빈 선언시 @Qualifier를 통해 수식자를 지정해 사용한다.</p></blockquote></blockquote> <ul><li>이름보단 묘사를 사용하는게 좋다. haagendaz 보단.. cold 같은..</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span>“cold”<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IceCream</span> <span class="token keyword">implements</span> <span class="token class-name">Dessert</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span>“cold”<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDessert</span><span class="token punctuation">(</span><span class="token class-name">Dessert</span> dessert<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dessert <span class="token operator">=</span> dessert
<span class="token punctuation">}</span>
</code></pre></div><blockquote><blockquote><p>같은 Qualifier값을 가지는 빈이 있는 경우엔?<br>
빈 선언시 @Qualifier를 통해 수식자를 여러개 지정해 사용</p></blockquote></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span>“cold”<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span>“creamy”<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IceCream</span> <span class="token keyword">implements</span> <span class="token class-name">Dessert</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span>“cold”<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span>“fruity”<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Juice</span> <span class="token keyword">implements</span> <span class="token class-name">Dessert</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Autowired</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span>“cold”<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span>“creamy”<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDessert</span><span class="token punctuation">(</span><span class="token class-name">Dessert</span> dessert<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dessert <span class="token operator">=</span> dessert
<span class="token punctuation">}</span>
</code></pre></div><blockquote><blockquote><p>같은 어노테이션을 중복해서 사용할수 없다. *자바 8에서는 @Repeatable 사용기 가능하나 @Qualifier는 예외<br>
직접 어노테이션을 생성해서 정의한다</p></blockquote></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>CONSRUCTOR<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>FIELD<span class="token punctuation">,</span>
         <span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetemtionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Qualifier</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Cold</span><span class="token punctuation">{</span> <span class="token punctuation">}</span>

<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>CONSRUCTOR<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>FIELD<span class="token punctuation">,</span>
         <span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetemtionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Qualifier</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Creamy</span><span class="token punctuation">{</span> <span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Cold</span>
<span class="token annotation punctuation">@Creamy</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Juice</span> <span class="token keyword">implements</span> <span class="token class-name">Dessert</span> <span class="token punctuation">{</span>…<span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>* 참고사항
@Autowired: 스프링이 타입(class)을 우선으로 bean 객체를 검색
- BinarySearchImpl은 SortAlgorithm 을 depends on 한다.
- SortAlgorithm은 BinarySearchImpl의 dependency다.
- autowiring 의 bean 선택은 3가지 (우선순위순)
- @Qualifier
- @Primary
- 변수명을 dependency 빈 이름으로 (ex private SortAlgorithm bubbleSortAlgorithm)


@Resource: 스프링이 이름(id)을 우선으로 bean 객체를 검색
- resourcing 의 bean 선택
- 지정한 name과 id가 같은 bean 객체
- 타입이 같은 bean 객체
- 만약 타입이 같은 bean 객체가 2개 이상이면, 변수명과 id가 같은 bean 객체
- @Qualifier가 지정한 bean 객체
</code></pre></div><h3 id="_4-beanscope"><a href="#_4-beanscope" class="header-anchor">#</a> 4. BeanScope</h3> <div class="language- extra-class"><pre class="language-text"><code>스프링에서 생성되는 빈은 기본적으로 ‘싱글톤’으로 생성됨
singleton : 기본 싱글톤 스코프
prototype : 어플리케이션에서 요청시 (getBean()) 마다 스프링이 새 인스턴스를 생성
session : HTTP 세션별로 인스턴스화되며 세션이 끝나며 소멸 (spring mvc webapplication 용도)
request : HTTP 요청별로 인스턴스화 되며 요청이 끝나면 소멸 (spring mvc webapplication 용도)
global session : 포틀릿 기반의 웹 어플리케이션 용도. 전역 세션 스코프의 빈은 같은 스프링 MVC를 사용한 포탈 어플리케이션 내의 모든 포틀릿 사이에서 공유할 수 있다
thred : 새 스레드에서 요청하면 새로운 bean 인스턴스를 생성, 같은 스레드에 대해서는 항상 같은 bean 인스턴스가 반환
custom : org.pringframework.beans.factory.config.Scope를 구현하고 커스텀 스코프를 스프링의 설정에 등록하여 사용
</code></pre></div><p>Sample Code - 프로토타입으로 선언하기</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableBeanFactory</span><span class="token punctuation">.</span>SCOPE_PROTOTYPE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Notepad</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>@Scope(“prototype”) 가능 하나 ConfigurableBeanFactory클래스의 SCOPE_PROTOTYPE 상수값 사용</li></ul> <p><strong>4.1 request, session 범위 작업</strong></p> <ul><li>웹 애플리케이션에서 특정 요청을 하거나, 세션 범위 내에서 공유하는 Bean을 인스턴스화할때 사용.<br>
예를 들어 장바구니를 나타내는 빈이 싱글톤일 경우에는 모든 사용자가 동일한 장바구니에 제품을 추가한다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span>
    value<span class="token operator">=</span><span class="token class-name">WebApplicationContext</span><span class="token punctuation">.</span>SCOPE_SESSION<span class="token punctuation">,</span> <span class="token comment">// 세션스코프 설정</span>
    proxyMode<span class="token operator">=</span><span class="token class-name">ScopedProxyMode</span><span class="token punctuation">.</span>INTERFACES<span class="token punctuation">)</span>      <span class="token comment">// INTERFACES 프록시 모드 설정, 인터페이스를 구현하고 구현 빈에 위임할 필요가 있다는 의미로 설정</span>
<span class="token keyword">public</span> <span class="token class-name">ShoppingCart</span> <span class="token function">cart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-런타임-값-주입"><a href="#_5-런타임-값-주입" class="header-anchor">#</a> 5. 런타임 값 주입</h3> <p>빈 와이어링 할때 프러퍼티나 인수를 하드코딩 형태로 참조하지않고 런타임에 결정되도록 하는 방법<br>
Sample Source : 하드코딩방식</p> <div class="language-java extra-class"><pre class="language-java"><code>   <span class="token annotation punctuation">@Component</span>
     <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GoodDayByIU</span> <span class="token keyword">implements</span> <span class="token class-name">CompactDisc</span> <span class="token punctuation">{</span>


       <span class="token keyword">private</span> <span class="token class-name">String</span> title <span class="token operator">=</span> <span class="token string">&quot;GoodDay&quot;</span>
       <span class="token keyword">private</span> <span class="token class-name">String</span> artist <span class="token operator">=</span> “IU”


       <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>“<span class="token class-name">Playing</span> “ <span class="token operator">+</span> title <span class="token operator">+</span> “ by “ <span class="token operator">+</span> artist<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
</code></pre></div><ol><li>프로퍼티 플레이스홀더(Property palceholders)</li> <li>스프링 표현 언어(SpEL, Spring Expression Language)</li></ol> <p><strong>5.1 외부 값 주입</strong>
가장 간단한 방법으로 프로퍼티소스를 선언하고 스프링환경에서 검색해서 사용한다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span>&quot;classpath<span class="token operator">:</span><span class="token operator">/</span>com<span class="token operator">/</span>soundsystem<span class="token operator">/</span>app<span class="token punctuation">.</span>properties”<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExpressiveConfig</span> <span class="token punctuation">{</span>


    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">Environment</span> env<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">BlankDisk</span> <span class="token function">disk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BlankDisc</span><span class="token punctuation">(</span>
                env<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;disc.title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                 env<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;disc.artist&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>app.properties<br>
disc.title=GoodDay<br>
disc.arties=IU</p> <p>getProperty() 함수 Overload()</p> <ul><li>String getProperty(String Key)</li> <li>String getProperty(String Key, String defaultValu e)</li> <li>T getProperty(String Key, Class<T> type)</T></li> <li>String getProperty(String Key, Class<T> type, T defaultValue)</T></li></ul> <ul><li>프러퍼티가 정의되지 않은 경우 IIegalStateExcrption이 발생한다 containProperty() 함수를 사용해서 check가능</li></ul> <p>(1) 프로퍼티 플레이스홀더(Property palceholders)
스프링 와이어링에서 플레이스홀더 값은 ${ ... }로 쌓여진 프로퍼티 명이다.</p> <p>xml형식</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sgtPapers<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>soundsystem.BalnkDisc<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">c:</span>_title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${disk.title}<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">c:</span>_artist</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${disc.artist}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>@AutoWired 애너테이션을 사용할 때와 동일한 방법으로 @Value 애너테이션을 사용한다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">BlankDisc</span><span class="token punctuation">(</span>
       <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${disc.title}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span>
       <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${disc.artist}&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> artist<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>artist <span class="token operator">=</span> artist<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>플레이스홀더 값을 사용하기 위해 PropertyPlaceholderConfiguraer 빈 또는 PropertySourcePlaceholderConfigurer 빈을 설정한다.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">PropertysourcesPlaceholderconfigurer</span> <span class="token function">placeholderConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PropertySourcesPlaceHolderConfigurer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>(2) 스프링 표현 언어(SpEL, Spring Expression Language)</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/sunny-archive/springFramework/springInAction/Chapter02.html" class="prev">
        Chapter02# Spring BeanWiring
      </a></span> <span class="next"><a href="/sunny-archive/springFramework/springInAction/Chapter04.html">
        Chapter04# AOP
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/sunny-archive/assets/js/app.20f77d52.js" defer></script><script src="/sunny-archive/assets/js/2.511b4fc5.js" defer></script><script src="/sunny-archive/assets/js/21.77345df6.js" defer></script>
  </body>
</html>
